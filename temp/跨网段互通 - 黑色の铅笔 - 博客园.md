# 跨网段互通 - 黑色の铅笔 - 博客园
        跨网段互通 - 黑色の铅笔 - 博客园          

 [![](https://img2022.cnblogs.com/blog/35695/202209/35695-20220901181700717-433675712.jpg)](https://www.cnblogs.com/cmt/p/16647139.html) 

*    [![](https://common.cnblogs.com/logo.svg)](https://www.cnblogs.com/ "开发者的网上家园") 
*   [首页](/)
*   [新闻](https://news.cnblogs.com/)
*   [博问](https://q.cnblogs.com/)
*   [专区](https://brands.cnblogs.com/)
*   [闪存](https://ing.cnblogs.com/)
*   [班级](https://edu.cnblogs.com/)

*    ![](https://common.cnblogs.com/images/blog/search.svg) 
    
*    [![](https://common.cnblogs.com/images/blog/newpost.svg)](https://i.cnblogs.com/EditPosts.aspx?opt=1 "写随笔") [ ![](https://common.cnblogs.com/images/blog/myblog.svg)
     ](https://passport.cnblogs.com/GetBlogApplyStatus.aspx "我的博客") [ ![](https://common.cnblogs.com/images/blog/message.svg)
      ](https://msg.cnblogs.com/ "短消息") [![](https://common.cnblogs.com/images/blog/lite-mode-on.svg)](javascript:void(0) "简洁模式启用，您在访问他人博客时会使用简洁款皮肤展示") 
    
     [![](https://common.cnblogs.com/images/blog/avatar-default.svg)](https://home.cnblogs.com/) 
    
    [我的博客](https://passport.cnblogs.com/GetBlogApplyStatus.aspx) [我的园子](https://home.cnblogs.com/) [账号设置](https://account.cnblogs.com/settings/account) [简洁模式 ![](https://www.cnblogs.com/images/lite-mode-check.svg)
    ... ](javascript:void(0) "简洁模式会使用简洁款皮肤显示所有博客") [退出登录](javascript:void(0))
    
    [注册](https://account.cnblogs.com/signup) [登录](javascript:void(0);)

| 

| 

[铅笔](https://www.cnblogs.com/zhaobinyouth/)
===========================================

在你的害怕中坚持的越多，你就会越自信 |

随笔 - 141, 文章 - 2, 评论 - 13, 阅读 - 41万

  [博客园](https://www.cnblogs.com/)  :: [首页](https://www.cnblogs.com/zhaobinyouth/)  :: [新随笔](https://i.cnblogs.com/EditPosts.aspx?opt=1)  :: [联系](https://msg.cnblogs.com/send/%E9%BB%91%E8%89%B2%E3%81%AE%E9%93%85%E7%AC%94) :: [订阅](javascript:void(0)) [![](https://www.cnblogs.com/skins/kjc/images/xml.gif)](https://www.cnblogs.com/zhaobinyouth/rss/)  :: [ 管理](https://i.cnblogs.com/)

 |
| 

| 
| [<](javascript:void(0);) | 2022年9月 | [\>](javascript:void(0);) | |
| 日 | 一 | 二 | 三 | 四 | 五 | 六 |
| 28 | 29 | 30 | 31 | 1 | 2 | 3 |
| 4 | 5 | 6 | 7 | 8 | 9 | 10 |
| 11 | 12 | 13 | 14 | 15 | 16 | 17 |
| 18 | 19 | 20 | 21 | 22 | 23 | 24 |
| 25 | 26 | 27 | 28 | 29 | 30 | 1 |
| 2 | 3 | 4 | 5 | 6 | 7 | 8 |

![](https://www.cnblogs.com/skins/kjc/images/icon-group.jpg)

### 公告

昵称： [黑色の铅笔](https://home.cnblogs.com/u/zhaobinyouth/)  
园龄： [5年10个月](https://home.cnblogs.com/u/zhaobinyouth/ "入园时间：2016-10-07")  
粉丝： [29](https://home.cnblogs.com/u/zhaobinyouth/followers/)  
关注： [39](https://home.cnblogs.com/u/zhaobinyouth/followees/)

[+加关注](javascript:void(0))

![](https://www.cnblogs.com/skins/kjc/images/icon-group.jpg)

### 搜索

 

 

![](https://www.cnblogs.com/skins/kjc/images/icon-group.jpg)

### 常用链接

*   [我的随笔](https://www.cnblogs.com/zhaobinyouth/p/ "我的博客的随笔列表")
*   [我的评论](https://www.cnblogs.com/zhaobinyouth/MyComments.html "我的发表过的评论列表")
*   [我的参与](https://www.cnblogs.com/zhaobinyouth/OtherPosts.html "我评论过的随笔列表")
*   [最新评论](https://www.cnblogs.com/zhaobinyouth/comments "我的博客的评论列表")
*   [我的标签](https://www.cnblogs.com/zhaobinyouth/tag/ "我的博客的标签列表")
*   [更多链接](#)

![](https://www.cnblogs.com/skins/kjc/images/icon-group.jpg)

### 我的标签

*   [C/C++(26)](https://www.cnblogs.com/zhaobinyouth/tag/C%2FC%2B%2B/)
*   [linux(22)](https://www.cnblogs.com/zhaobinyouth/tag/linux/)
*   [Qt学习笔记(19)](https://www.cnblogs.com/zhaobinyouth/tag/Qt%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/)
*   [零散碎片(18)](https://www.cnblogs.com/zhaobinyouth/tag/%E9%9B%B6%E6%95%A3%E7%A2%8E%E7%89%87/)
*   [数据结构实验(16)](https://www.cnblogs.com/zhaobinyouth/tag/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AE%9E%E9%AA%8C/)
*   [图像处理笔记(12)](https://www.cnblogs.com/zhaobinyouth/tag/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E7%AC%94%E8%AE%B0/)
*   [pcl(11)](https://www.cnblogs.com/zhaobinyouth/tag/pcl/)
*   [流媒体(6)](https://www.cnblogs.com/zhaobinyouth/tag/%E6%B5%81%E5%AA%92%E4%BD%93/)
*   [linux系统编程(5)](https://www.cnblogs.com/zhaobinyouth/tag/linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/)
*   [调试技巧(3)](https://www.cnblogs.com/zhaobinyouth/tag/%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7/)
*   [更多](https://www.cnblogs.com/zhaobinyouth/tag/)

![](https://www.cnblogs.com/skins/kjc/images/icon-group.jpg)

### 随笔档案

*   [2022年3月(2)](https://www.cnblogs.com/zhaobinyouth/archive/2022/03.html)
*   [2021年10月(6)](https://www.cnblogs.com/zhaobinyouth/archive/2021/10.html)
*   [2021年9月(1)](https://www.cnblogs.com/zhaobinyouth/archive/2021/09.html)
*   [2021年8月(5)](https://www.cnblogs.com/zhaobinyouth/archive/2021/08.html)
*   [2021年5月(2)](https://www.cnblogs.com/zhaobinyouth/archive/2021/05.html)
*   [2021年2月(1)](https://www.cnblogs.com/zhaobinyouth/archive/2021/02.html)
*   [2021年1月(1)](https://www.cnblogs.com/zhaobinyouth/archive/2021/01.html)
*   [2020年11月(3)](https://www.cnblogs.com/zhaobinyouth/archive/2020/11.html)
*   [2020年10月(4)](https://www.cnblogs.com/zhaobinyouth/archive/2020/10.html)
*   [2020年9月(1)](https://www.cnblogs.com/zhaobinyouth/archive/2020/09.html)
*   [2020年5月(3)](https://www.cnblogs.com/zhaobinyouth/archive/2020/05.html)
*   [2020年4月(8)](https://www.cnblogs.com/zhaobinyouth/archive/2020/04.html)
*   [2020年3月(1)](https://www.cnblogs.com/zhaobinyouth/archive/2020/03.html)
*   [2020年2月(2)](https://www.cnblogs.com/zhaobinyouth/archive/2020/02.html)
*   [2020年1月(2)](https://www.cnblogs.com/zhaobinyouth/archive/2020/01.html)
*   [2019年11月(2)](https://www.cnblogs.com/zhaobinyouth/archive/2019/11.html)
*   [2019年10月(2)](https://www.cnblogs.com/zhaobinyouth/archive/2019/10.html)
*   [2019年9月(1)](https://www.cnblogs.com/zhaobinyouth/archive/2019/09.html)
*   [2019年6月(1)](https://www.cnblogs.com/zhaobinyouth/archive/2019/06.html)
*   [2019年5月(1)](https://www.cnblogs.com/zhaobinyouth/archive/2019/05.html)
*   [2019年4月(2)](https://www.cnblogs.com/zhaobinyouth/archive/2019/04.html)
*   [2018年11月(5)](https://www.cnblogs.com/zhaobinyouth/archive/2018/11.html)
*   [2018年10月(5)](https://www.cnblogs.com/zhaobinyouth/archive/2018/10.html)
*   [2018年9月(6)](https://www.cnblogs.com/zhaobinyouth/archive/2018/09.html)
*   [2018年8月(11)](https://www.cnblogs.com/zhaobinyouth/archive/2018/08.html)
*   [2018年7月(2)](https://www.cnblogs.com/zhaobinyouth/archive/2018/07.html)
*   [2018年6月(1)](https://www.cnblogs.com/zhaobinyouth/archive/2018/06.html)
*   [2018年4月(4)](https://www.cnblogs.com/zhaobinyouth/archive/2018/04.html)
*   [2017年10月(7)](https://www.cnblogs.com/zhaobinyouth/archive/2017/10.html)
*   [2017年3月(3)](https://www.cnblogs.com/zhaobinyouth/archive/2017/03.html)
*   [2017年1月(15)](https://www.cnblogs.com/zhaobinyouth/archive/2017/01.html)
*   [2016年12月(31)](https://www.cnblogs.com/zhaobinyouth/archive/2016/12.html)
*   [更多](javascript:void(0))

![](https://www.cnblogs.com/skins/kjc/images/icon-group.jpg)

### [文章分类](https://www.cnblogs.com/zhaobinyouth/categories)

*   [C/C++学习(1)](https://www.cnblogs.com/zhaobinyouth/category/920895.html)

![](https://www.cnblogs.com/skins/kjc/images/icon-group.jpg)

### [阅读排行榜](https://www.cnblogs.com/zhaobinyouth/most-viewed)

*   [1\. 数组作为函数的参数(31308)](https://www.cnblogs.com/zhaobinyouth/p/6207300.html)
*   [2\. SVN 回退到某一个版本(25474)](https://www.cnblogs.com/zhaobinyouth/p/12654060.html)
*   [3\. Qt中窗口退出事件(24886)](https://www.cnblogs.com/zhaobinyouth/p/9478010.html)
*   [4\. C/C++中带可变参数的函数(18074)](https://www.cnblogs.com/zhaobinyouth/p/8781915.html)
*   [5\. Qt对话框QDialog(16773)](https://www.cnblogs.com/zhaobinyouth/p/6265320.html)

![](https://www.cnblogs.com/skins/kjc/images/icon-group.jpg)

### [评论排行榜](https://www.cnblogs.com/zhaobinyouth/most-commented)

*   [1\. Qt 中的事件处理（一）(9)](https://www.cnblogs.com/zhaobinyouth/p/7688954.html)
*   [2\. FFMPEG Qt视频播放器(2)](https://www.cnblogs.com/zhaobinyouth/p/9124960.html)
*   [3\. 调试技巧之宏定义开关(1)](https://www.cnblogs.com/zhaobinyouth/p/7688182.html)
*   [4\. register\_chrdev\_region/alloc\_chrdev\_region和cdev注册字符设备驱动(1)](https://www.cnblogs.com/zhaobinyouth/p/6227644.html)

![](https://www.cnblogs.com/skins/kjc/images/icon-group.jpg)

### [推荐排行榜](https://www.cnblogs.com/zhaobinyouth/most-liked)

*   [1\. 数组作为函数的参数(4)](https://www.cnblogs.com/zhaobinyouth/p/6207300.html)
*   [2\. Qt 中的事件处理（一）(3)](https://www.cnblogs.com/zhaobinyouth/p/7688954.html)
*   [3\. notepad更改文档编码格式(2)](https://www.cnblogs.com/zhaobinyouth/p/12759335.html)
*   [4\. Qt 对象间的父子关系(2)](https://www.cnblogs.com/zhaobinyouth/p/6262331.html)
*   [5\. register\_chrdev\_region/alloc\_chrdev\_region和cdev注册字符设备驱动(2)](https://www.cnblogs.com/zhaobinyouth/p/6227644.html)

![](https://www.cnblogs.com/skins/kjc/images/icon-group.jpg)

### [最新评论](https://www.cnblogs.com/zhaobinyouth/comments)

*   [1\. Re:Qt 中的事件处理（一）](https://www.cnblogs.com/zhaobinyouth/p/7688954.html)
*   @汇泉 是这个意思吧...
*   \--黑色の铅笔
*   [2\. Re:Qt 中的事件处理（一）](https://www.cnblogs.com/zhaobinyouth/p/7688954.html)
*   @汇泉 myButton(this, 0)...
*   \--黑色の铅笔
*   [3\. Re:Qt 中的事件处理（一）](https://www.cnblogs.com/zhaobinyouth/p/7688954.html)
*   @汇泉 重写这个事件处理函数就可以了鸭...
*   \--黑色の铅笔
*   [4\. Re:Qt 中的事件处理（一）](https://www.cnblogs.com/zhaobinyouth/p/7688954.html)
*   QPushButton::mouseReleaseEvent(e);
    
*   \--汇泉
*   [5\. Re:Qt 中的事件处理（一）](https://www.cnblogs.com/zhaobinyouth/p/7688954.html)
*   请问怎样让connect(&myButton, SIGNAL(clicked()), this, SLOT(onMyButtonClicked()));这条语句执行呢？
    
*   \--汇泉













 | 

[跨网段互通](https://www.cnblogs.com/zhaobinyouth/p/15470497.html)
-------------------------------------------------------------

Posted on 2021-10-27 14:20  [黑色の铅笔](https://www.cnblogs.com/zhaobinyouth/)  阅读(877)  评论(0)  [编辑](https://i.cnblogs.com/EditPosts.aspx?postid=15470497)  [收藏](javascript:void(0))  [举报](javascript:void(0))

1.简介
====

TCP协议规定只有处于同一个网段的IP才能实现互通，如果处于不同网段，可以配置一台双网卡机器为网关然后指定路由线路实现跨网段访问。上一节的端口映射只是针对某台服务器中的少量端口进行映射的一个方案，但是如果有很多服务程序需要进行映射无疑是一个大量的工作，这个时候如果安全允许的情况下则可以进行路由方案将一台服务器完全暴露给外部进行交互。

实现思路：将双网卡服务器作为一个代理服务器，实现双向网关的一个功能

![](https://img2020.cnblogs.com/blog/1037399/202110/1037399-20211027141850013-864694575.png)

如上图所示，Proxy作为双向网关

Client如果要实现Server的互通，如果Client和Server在同一个子网段可以直接ping同，但是如果不在同一个网段，Client就会先去找其网关，再由其网关寻找Server,对于Server也是这样。

 ![](https://img2020.cnblogs.com/blog/1037399/202110/1037399-20211027141911671-976627874.png)

2.实现方案
======

2.1代理
-----

### 1.开启数据包的转发功能

代理服务器打开终端执行如下命令

echo 1 >/proc/sys/net/ipv4/ip\_forward 

默认值0是禁止数据包转发，修改为1即开启数据包转发功能。如果提示无权限，可以使用vi或者gedit工具打开ip\_forward文件直接修改。

### 2.设置路由表

先说配置方法：

1\. 代理服务器中新增发往Server端的路由表

sudo route add -net 10.168.9.0 netmask 255.255.255.0 dev eth1 

这条路由表的含义就是发往10.168.9.0/24网段的数据包都由eth1网卡发出

2.代理服务器中新增发往Client端的路由表

新增静态路由sudo route add -net ip dev 网卡

删除静态路由sudo route del-net ip dev 网卡

sudo route add -net 192.168.1.0/24 netmask 255.255.255.0 dev eth0

这条路由表的含义就是发往192.168.1.0/24网段的数据包都由eth0网卡发出

3\. Client服务器中设置网关为192.168.1.1

1 sudo route add default gw 192.168.1.1

 设置之后就表示当Client端连接其他网段（非Client子网）时，就会找到192.168.1.1，进而使用192.168.1.1进行连接

注意：

网关只能设置为同一网段的其他IP；

如果只是设置了网关但是没有在代理服务器中指定路由表（即步骤1,2），则Client端可以ping通代理上面的两张网卡，但是不能ping通10.168.1.xx的其他子网，即不能ping通Server端

4\. Server端设置网关为10.168.9.1

sudo route add defaultgw 10.168.9.1

以上步骤执行之后则可以互相ping通

标签: [linux](https://www.cnblogs.com/zhaobinyouth/tag/linux/)

[好文要顶](javascript:void(0);) [关注我](javascript:void(0);) [收藏该文](javascript:void(0);) [![](https://common.cnblogs.com/images/icon_weibo_24.png)
](javascript:void(0); "分享至新浪微博") [![](https://common.cnblogs.com/images/wechat.png)
](javascript:void(0); "分享至微信")

[![](https://pic.cnblogs.com/face/1037399/20170414151209.png)
](https://home.cnblogs.com/u/zhaobinyouth/)

[黑色の铅笔](https://home.cnblogs.com/u/zhaobinyouth/)  
[粉丝 - 29](https://home.cnblogs.com/u/zhaobinyouth/followers/) [关注 - 39](https://home.cnblogs.com/u/zhaobinyouth/followees/)  

[+加关注](javascript:void(0);)

0

0

[«](https://www.cnblogs.com/zhaobinyouth/p/15443090.html) 上一篇： [更改 用户名@主机名](https://www.cnblogs.com/zhaobinyouth/p/15443090.html "发布于 2021-10-23 14:10")  
[»](https://www.cnblogs.com/zhaobinyouth/p/15471632.html) 下一篇： [E: Unable to fetch some archives, maybe run apt-get update or try with --fix-missing?](https://www.cnblogs.com/zhaobinyouth/p/15471632.html "发布于 2021-10-27 17:03")

[刷新评论](javascript:void(0);)[刷新页面](#)[返回顶部](#top)

登录后才能查看或发表评论，立即 [登录](javascript:void(0);) 或者 [逛逛](https://www.cnblogs.com/) 博客园首页

[【推荐】云安全践行者：亚马逊云科技如何打好“安全”牌？](https://www.cnblogs.com/cmt/p/16647139.html)  
[【推荐】腾讯云多款云产品1折起，买云服务器送免费机器](https://curl.qcloud.com/k19RDMHo)  
[【推荐】下一步，敏捷！云可达科技SpecDD敏捷开发专区](https://brands.cnblogs.com/specdd)  

**编辑推荐：**   
· [CPU 流水线与指令乱序执行](https://www.cnblogs.com/chanmufeng/p/16658844.html)  
· [\[WPF\] 使用 HandyControl 的 CirclePanel 画出表盘刻度](https://www.cnblogs.com/dino623/p/16471012.html)  
· [踩坑 Windows 服务来宿主 .NET 程序](https://www.cnblogs.com/kklldog/p/host-net-on-windows-service.html)  
· [巧用 transition 实现短视频 APP 点赞动画](https://www.cnblogs.com/coco1s/p/16638418.html)  
· [技术基建如何降本增效——云迁移](https://www.cnblogs.com/yexiaochai/p/16636896.html)  

**最新新闻**：  
· [美妆巨头暗中押注，合成生物学遇上新风口](//news.cnblogs.com/n/727826/)  
· [华为Mate 50发布，4999元起，全球首款支持北斗卫星消息的智能手机](//news.cnblogs.com/n/727825/)  
· [熬夜「人参水」成爆火新茶饮，2 元人参泡出的安慰剂无用却诱人](//news.cnblogs.com/n/727824/)  
· [姚期智院士主编的大学教材《人工智能》正式出版](//news.cnblogs.com/n/727823/)  
· [大厂月饼各不相同，被一只「长鹅」拉到一起](//news.cnblogs.com/n/727822/)  
» [更多新闻...](https://news.cnblogs.com/ "IT 新闻")







 |
| 

Powered by:  
[博客园](https://www.cnblogs.com/)  
Copyright © 2022 黑色の铅笔  
Powered by .NET 6 on Kubernetes

 |